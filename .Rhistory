UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs), read.csv))
###Missing Rate
missing_count_n_UK <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK <- round(missing_count_n_UK/nrow(UK_rawdata),2)
mean(missing_perc_UK)
missing_perc_UK
MIMIC3_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/MIMIC3_DL_input_data/onRRT/Hourly_interp/Filtered_FeatureFiles/"
MIMIC3_Data <- read.csv(paste0(MIMIC3_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
MIMIC3_IDs <- unique(sapply(strsplit(MIMIC3_Data$SUBJECT_ID,split = "_"), "[[", 1))
length(MIMIC3_IDs)
#### Load MIMIC 3 raw RRT
MIMIC3_onRRT_raw_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/Original_Sample_Data/onRRT/onRRT_raw/"
MIMIC3_files <- list.files(MIMIC3_onRRT_raw_dir)
MIMIC3_files_for_FinalIDs <- MIMIC3_files[which(gsub("onRRT_raw.csv","",MIMIC3_files) %in%  MIMIC3_IDs== T)]
MIMIC3_rawdata <- do.call(rbind,lapply(paste0(MIMIC3_onRRT_raw_dir,MIMIC3_files_for_FinalIDs), read.csv))
###Missing Rate
missing_count_n_MIMIC3 <- sapply(MIMIC3_rawdata, function(x) sum(is.na(x)))
missing_perc_MIMIC3 <- round(missing_count_n/nrow(MIMIC3_rawdata),2)
missing_perc_MIMIC3
mean(missing_perc_MIMIC3)
#MIMICs Final IDs
MIMIC3_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/MIMIC3_DL_input_data/onRRT/Hourly_interp/Filtered_FeatureFiles/"
MIMIC3_Data <- read.csv(paste0(MIMIC3_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
MIMIC3_IDs <- unique(sapply(strsplit(MIMIC3_Data$SUBJECT_ID,split = "_"), "[[", 1))
length(MIMIC3_IDs)
#### Load MIMIC 3 raw RRT
MIMIC3_onRRT_raw_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/Original_Sample_Data/onRRT/onRRT_raw/"
MIMIC3_files <- list.files(MIMIC3_onRRT_raw_dir)
MIMIC3_files_for_FinalIDs <- MIMIC3_files[which(gsub("onRRT_raw.csv","",MIMIC3_files) %in%  MIMIC3_IDs== T)]
MIMIC3_rawdata <- do.call(rbind,lapply(paste0(MIMIC3_onRRT_raw_dir,MIMIC3_files_for_FinalIDs), read.csv))
###Missing Rate
missing_count_n_MIMIC3 <- sapply(MIMIC3_rawdata, function(x) sum(is.na(x)))
missing_perc_MIMIC3 <- round(missing_count_n_MIMIC3/nrow(MIMIC3_rawdata),2)
missing_perc_MIMIC3
missing_count_n_MIMIC3
which(colnames(MIMIC3_rawdata) %in% c("Temp","WBC"))
#exclude the 2 features has missing rate == 1
MIMIC3_rawdata <- MIMIC3_rawdata[,-which(colnames(MIMIC3_rawdata) %in% c("Temp","WBC"))]
###Missing Rate
missing_count_n_MIMIC3 <- sapply(MIMIC3_rawdata, function(x) sum(is.na(x)))
missing_perc_MIMIC3 <- round(missing_count_n_MIMIC3/nrow(MIMIC3_rawdata),2)
missing_perc_MIMIC3
mean(missing_perc_MIMIC3)
MIMIC3_static_data <- read.csv(paste0(MIMIC3_onRRT_raw_dir,"final_demo_df.csv"),stringsAsFactors = F)
MIMIC3_static_data <- read.csv(paste0(MIMIC3_dir,"final_demo_df.csv"),stringsAsFactors = F)
View(MIMIC3_static_data)
sapply(MIMIC3_static_data, function(x) sum(is.na(x)))
View(MIMIC3_static_data)
MIMIC3_static_data$SUBJECT_ID <- sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1)
#####Load static data MIMIC3
MIMIC3_static_data <- read.csv(paste0(MIMIC3_dir,"final_demo_df.csv"),stringsAsFactors = F)
MIMIC3_static_data$SUBJECT_ID
MIMIC3_static_data$SUBJECT_ID <- sapply(strsplit(MIMIC3_static_data$SUBJECT_ID,split = "_"), "[[", 1)
MIMIC3_static_data <- MIMIC3_static_data[!duplicated(MIMIC3_static_data$SUBJECT_ID),]
sapply(MIMIC3_static_data, function(x) sum(is.na(x)))
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data, function(x) sum(is.na(x)))
missing_perc_MIMIC3_1 <- round(missing_count_n_MIMIC3_1/nrow(MIMIC3_static_data),2)
missing_perc_MIMIC3_1
###Missing Rate
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata, function(x) sum(is.na(x)))
missing_count_n_MIMIC3_2
###Missing Rate
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
missing_count_n_MIMIC3_2
comb_missing_df_MIMIC3 <- cbind(missing_count_n_MIMIC3_1,missing_count_n_MIMIC3_2)
comb_missing_df_MIMIC3
comb_missing_df_MIMIC3 <- rbind(missing_count_n_MIMIC3_1,missing_count_n_MIMIC3_2)
comb_missing_df_MIMIC3
missing_count_n_MIMIC3_1
missing_count_n_MIMIC3_2
comb_missing_df_MIMIC3 <- rbind(as.data.frame(missing_count_n_MIMIC3_1),as.data.frame(missing_count_n_MIMIC3_2))
comb_missing_df_MIMIC3 <- cbind(as.data.frame(missing_count_n_MIMIC3_1),as.data.frame(missing_count_n_MIMIC3_2))
comb_missing_df_MIMIC3 <- c(as.data.frame(missing_count_n_MIMIC3_1),as.data.frame(missing_count_n_MIMIC3_2))
comb_missing_df_MIMIC3
comb_missing_df_MIMIC3 <- c(missing_count_n_MIMIC3_1,missing_count_n_MIMIC3_2)
comb_missing_df_MIMIC3
missing_count_n_MIMIC3_1
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
View(MIMIC3_rawdata)
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data[,2:ncol(MIMIC3_static_data)], function(x) sum(is.na(x)))
missing_count_n_MIMIC3_1
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
missing_count_n_MIMIC3_2
nrow(MIMIC3_static_data)
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
comb_missing_df_MIMIC3 <- c(missing_count_n_MIMIC3_1,missing_count_n_MIMIC3_2)
comb_missing_df_MIMIC3
#exclude the 2 features has missing rate == 1
MIMIC3_rawdata <- MIMIC3_rawdata[,-which(colnames(MIMIC3_rawdata) %in% c("Temp","WBC"," onRRT"))]
#####Load static data MIMIC3
MIMIC3_static_data <- read.csv(paste0(MIMIC3_dir,"final_demo_df.csv"),stringsAsFactors = F)
MIMIC3_static_data$SUBJECT_ID <- sapply(strsplit(MIMIC3_static_data$SUBJECT_ID,split = "_"), "[[", 1)
MIMIC3_static_data <- MIMIC3_static_data[!duplicated(MIMIC3_static_data$SUBJECT_ID),]
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data[,2:ncol(MIMIC3_static_data)], function(x) sum(is.na(x)))
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
#### Load MIMIC 3 raw RRT
MIMIC3_onRRT_raw_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/Original_Sample_Data/onRRT/onRRT_raw/"
MIMIC3_files <- list.files(MIMIC3_onRRT_raw_dir)
MIMIC3_files_for_FinalIDs <- MIMIC3_files[which(gsub("onRRT_raw.csv","",MIMIC3_files) %in%  MIMIC3_IDs== T)]
MIMIC3_rawdata <- do.call(rbind,lapply(paste0(MIMIC3_onRRT_raw_dir,MIMIC3_files_for_FinalIDs), read.csv))
#exclude the 2 features has missing rate == 1
MIMIC3_rawdata <- MIMIC3_rawdata[,-which(colnames(MIMIC3_rawdata) %in% c("Temp","WBC"," onRRT"))]
#####Load static data MIMIC3
MIMIC3_static_data <- read.csv(paste0(MIMIC3_dir,"final_demo_df.csv"),stringsAsFactors = F)
MIMIC3_static_data$SUBJECT_ID <- sapply(strsplit(MIMIC3_static_data$SUBJECT_ID,split = "_"), "[[", 1)
MIMIC3_static_data <- MIMIC3_static_data[!duplicated(MIMIC3_static_data$SUBJECT_ID),]
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data[,2:ncol(MIMIC3_static_data)], function(x) sum(is.na(x)))
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
comb_missing_df_MIMIC3 <- c(missing_count_n_MIMIC3_1,missing_count_n_MIMIC3_2)
comb_missing_df_MIMIC3
ncol(comb_missing_df_MIMIC3)
length(comb_missing_df_MIMIC3)
colnames(MIMIC3_rawdata)
#### Load MIMIC 3 raw RRT
MIMIC3_onRRT_raw_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/Original_Sample_Data/onRRT/onRRT_raw/"
MIMIC3_files <- list.files(MIMIC3_onRRT_raw_dir)
MIMIC3_files_for_FinalIDs <- MIMIC3_files[which(gsub("onRRT_raw.csv","",MIMIC3_files) %in%  MIMIC3_IDs== T)]
MIMIC3_rawdata <- do.call(rbind,lapply(paste0(MIMIC3_onRRT_raw_dir,MIMIC3_files_for_FinalIDs), read.csv))
#exclude the 2 features has missing rate == 1
MIMIC3_rawdata <- MIMIC3_rawdata[,-which(colnames(MIMIC3_rawdata) %in% c("Temp","WBC","onRRT"))]
#####Load static data MIMIC3
MIMIC3_static_data <- read.csv(paste0(MIMIC3_dir,"final_demo_df.csv"),stringsAsFactors = F)
MIMIC3_static_data$SUBJECT_ID <- sapply(strsplit(MIMIC3_static_data$SUBJECT_ID,split = "_"), "[[", 1)
MIMIC3_static_data <- MIMIC3_static_data[!duplicated(MIMIC3_static_data$SUBJECT_ID),]
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data[,2:ncol(MIMIC3_static_data)], function(x) sum(is.na(x)))
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
comb_missing_df_MIMIC3 <- c(missing_count_n_MIMIC3_1,missing_count_n_MIMIC3_2)
missing_perc_MIMIC3 <- round(missing_count_n_MIMIC3/nrow(MIMIC3_rawdata),2)
missing_perc_MIMIC3
length(comb_missing_df_MIMIC3)
missing_perc_MIMIC3 <- round(comb_missing_df_MIMIC3/170,2)
missing_perc_MIMIC3
mean(missing_perc_MIMIC3)
comb_missing_df_MIMIC3
missing_perc_MIMIC3_1 <- round(missing_count_n_MIMIC3_1/nrow(MIMIC3_static_data),2)
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata[,2:ncol(MIMIC3_rawdata)], function(x) sum(is.na(x)))
missing_perc_MIMIC3_2 <- round(missing_count_n_MIMIC3_2/nrow(MIMIC3_rawdata),2)
missing_perc_MIMIC3_2
mean(missing_perc_MIMIC3_2)
missing_perc_MIMIC3_1
mean(c(missing_perc_MIMIC3_1,missing_perc_MIMIC3_2))
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data[,2:ncol(UK_static_data)], function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
colnames(UK_rawdata)
table(UK_rawdata$onRRT)
View(UK_rawdata)
#### Load MIMIC 3 raw RRT
MIMIC3_onRRT_raw_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/Original_Sample_Data/onRRT/onRRT_raw/"
MIMIC3_files <- list.files(MIMIC3_onRRT_raw_dir)
MIMIC3_files_for_FinalIDs <- MIMIC3_files[which(gsub("onRRT_raw.csv","",MIMIC3_files) %in%  MIMIC3_IDs== T)]
MIMIC3_rawdata <- do.call(rbind,lapply(paste0(MIMIC3_onRRT_raw_dir,MIMIC3_files_for_FinalIDs), read.csv))
View(MIMIC3_Data)
View(MIMIC3_rawdata)
View(UK_rawdata)
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[1:10]), read.csv))
View(UK_rawdata)
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[1:9]), read.csv))
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[1:5]), read.csv))
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[5:5]), read.csv))
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[4:4]), read.csv))
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[3:3]), read.csv))
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[2:2]), read.csv))
UK_files_for_FinalIDs[2]
#####UK Final IDs
UK_data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/DL_input_data/onRRT/Hourly_interp/"
UK_Data <- read.csv(paste0(UK_data_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
UK_Final_IDs <- unique(sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1))
UK_Final_IDs
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[2:2]), read.csv))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT"))]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
#####UK Final IDs
UK_data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/DL_input_data/onRRT/Hourly_interp/"
UK_Data <- read.csv(paste0(UK_data_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
UK_Final_IDs <- unique(sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1))
UK_Final_IDs
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs[2:2]), read.csv))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT"))]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs), read.csv))
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data[,2:ncol(UK_static_data)], function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
mean(c(missing_perc_UK_1,missing_perc_UK_2))
missing_perc_UK_1
colnames(UK_static_data)
UK_static_data <- UK_static_data[,-1]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data <- UK_static_data[,-1]
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
colnames(UK_static_data)
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data[,2:ncol(UK_static_data)], function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
UK_static_data <- UK_static_data[,-which(colnames(UK_static_data) %in% c("ENCNTR_ID"))]
UK_static_data
colnames(UK_static_data)
nrow(UK_static_data)
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data, function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
colnames(UK_rawdata)
#####UK Final IDs
UK_data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/DL_input_data/onRRT/Hourly_interp/"
UK_Data <- read.csv(paste0(UK_data_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
UK_Final_IDs <- unique(sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1))
UK_Final_IDs
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs), read.csv))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT","Record_Time"))]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data <- UK_static_data[,-1]
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
UK_static_data <- UK_static_data[,-which(colnames(UK_static_data) %in% c("ENCNTR_ID"))]
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data, function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
mean(c(missing_perc_UK_1,missing_perc_UK_2)) #43%
length(c(missing_perc_UK_1,missing_perc_UK_2))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT","Record_Time","FIO2","PH","PO2"))]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
#####UK Final IDs
UK_data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/DL_input_data/onRRT/Hourly_interp/"
UK_Data <- read.csv(paste0(UK_data_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
UK_Final_IDs <- unique(sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1))
UK_Final_IDs
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs), read.csv))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT","Record_Time","FIO2","PH","PO2"))]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data <- UK_static_data[,-1]
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
UK_static_data <- UK_static_data[,-which(colnames(UK_static_data) %in% c("ENCNTR_ID"))]
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data, function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
length(c(missing_perc_UK_1,missing_perc_UK_2)) #25 features
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT","Record_Time","FIO2","PH","PO2"," onMV"))]
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
#####UK Final IDs
UK_data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/DL_input_data/onRRT/Hourly_interp/"
UK_Data <- read.csv(paste0(UK_data_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
UK_Final_IDs <- unique(sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1))
UK_Final_IDs
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs), read.csv))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT","Record_Time","FIO2","PH","PO2"," onMV"))]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data <- UK_static_data[,-1]
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
UK_static_data <- UK_static_data[,-which(colnames(UK_static_data) %in% c("ENCNTR_ID"))]
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data, function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
length(c(missing_perc_UK_1,missing_perc_UK_2)) #22 features
mean(c(missing_perc_UK_1,missing_perc_UK_2)) #48%
#####UK Final IDs
UK_data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/DL_input_data/onRRT/Hourly_interp/"
UK_Data <- read.csv(paste0(UK_data_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
UK_Final_IDs <- unique(sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1))
UK_Final_IDs
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs), read.csv))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT","Record_Time","FIO2","PH","PO2","onMV"))]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data <- UK_static_data[,-1]
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
UK_static_data <- UK_static_data[,-which(colnames(UK_static_data) %in% c("ENCNTR_ID"))]
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data, function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
length(c(missing_perc_UK_1,missing_perc_UK_2)) #22 features
mean(c(missing_perc_UK_1,missing_perc_UK_2)) #48%
#MIMICs Final IDs
MIMIC3_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/MIMIC3_DL_input_data/onRRT/Hourly_interp/Filtered_FeatureFiles/"
MIMIC3_Data <- read.csv(paste0(MIMIC3_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
MIMIC3_IDs <- unique(sapply(strsplit(MIMIC3_Data$SUBJECT_ID,split = "_"), "[[", 1))
length(MIMIC3_IDs)
#### Load MIMIC 3 raw RRT
MIMIC3_onRRT_raw_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/Original_Sample_Data/onRRT/onRRT_raw/"
MIMIC3_files <- list.files(MIMIC3_onRRT_raw_dir)
MIMIC3_files_for_FinalIDs <- MIMIC3_files[which(gsub("onRRT_raw.csv","",MIMIC3_files) %in%  MIMIC3_IDs== T)]
MIMIC3_rawdata <- do.call(rbind,lapply(paste0(MIMIC3_onRRT_raw_dir,MIMIC3_files_for_FinalIDs), read.csv))
colnames(MIMIC3_rawdata)
#exclude the 2 features has missing rate == 1
MIMIC3_rawdata <- MIMIC3_rawdata[,-which(colnames(MIMIC3_rawdata) %in% c("Temp","WBC","onRRT","Record_Time"))]
#####Load static data MIMIC3
MIMIC3_static_data <- read.csv(paste0(MIMIC3_dir,"final_demo_df.csv"),stringsAsFactors = F)
MIMIC3_static_data$SUBJECT_ID <- sapply(strsplit(MIMIC3_static_data$SUBJECT_ID,split = "_"), "[[", 1)
MIMIC3_static_data <- MIMIC3_static_data[!duplicated(MIMIC3_static_data$SUBJECT_ID),]
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data, function(x) sum(is.na(x)))
missing_perc_MIMIC3_1 <- round(missing_count_n_MIMIC3_1/nrow(MIMIC3_static_data),2)
missing_perc_MIMIC3_1
MIMIC3_static_data <- MIMIC3_static_data[,-which(colnames(MIMIC3_static_data) %in% c("SUBJECT_ID"))]
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data, function(x) sum(is.na(x)))
missing_perc_MIMIC3_1 <- round(missing_count_n_MIMIC3_1/nrow(MIMIC3_static_data),2)
missing_perc_MIMIC3_1
colnames(MIMIC3_rawdata)
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata, function(x) sum(is.na(x)))
missing_perc_MIMIC3_2 <- round(missing_count_n_MIMIC3_2/nrow(MIMIC3_rawdata),2)
missing_perc_MIMIC3_2
mean(c(missing_perc_MIMIC3_1,missing_perc_MIMIC3_2)) #34%
length(c(missing_perc_MIMIC3_1,missing_perc_MIMIC3_2))
mean(missing_perc_MIMIC3_2)
mean(missing_perc_UK_2) #49.3% for dynamic feature
data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0114_21_data/"
TransE_Vector <- read.csv(paste0(data_dir,"HPO_TransE_Embed_Vector.csv"))
grp1_dxes <- which(TransE_Vector["Grps"] == "Cardi") #5
grp2_dxes <- which(TransE_Vector["Grps"] == "Meta") #15
grp3_dxes <- which(TransE_Vector["Grps"] == "Blood") #4
grp4_dxes <- which(TransE_Vector["Grps"] == "Resp")  #3
View(TransE_Vector)
TransE_Vector_grp1 <- TransE_Vector[grp1_dxes,]
TransE_Vector_grp2 <- TransE_Vector[grp2_dxes,]
TransE_Vector_grp3 <- TransE_Vector[grp3_dxes,]
TransE_Vector_grp4 <- TransE_Vector[grp4_dxes,]
#Drop names and grp names
names_todrop <- c("X","HPO_name","Grps")
TransE_Vector_grp1 <- TransE_Vector_grp1[, -which(colnames(TransE_Vector_grp1) %in% names_todrop)]
TransE_Vector_grp2 <- TransE_Vector_grp2[, -which(colnames(TransE_Vector_grp2) %in% names_todrop)]
TransE_Vector_grp3 <- TransE_Vector_grp3[, -which(colnames(TransE_Vector_grp3) %in% names_todrop)]
TransE_Vector_grp4 <- TransE_Vector_grp4[, -which(colnames(TransE_Vector_grp4) %in% names_todrop)]
#Sum for  each group
TransE_Vector_sum_grp1 <- colSums(TransE_Vector_grp1)
TransE_Vector_sum_grp1
View(TransE_Vector_grp1)
TransE_Vector_grp3
TransE_Vector_grp4
TransE_Vector_grp1
TransE_Vector_grp2
nrow(TransE_Vector_grp2)
mean(c(missing_perc_MIMIC3_2)) #34.6%
#####UK Final IDs
UK_data_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/DL_input_data/onRRT/Hourly_interp/"
UK_Data <- read.csv(paste0(UK_data_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
UK_Final_IDs <- unique(sapply(strsplit(UK_Data$ENCNTR_ID,split = "_"), "[[", 1))
UK_Final_IDs
#### Load UK raw dynamic RRT
UK_onRRT_raw_dir <- "/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/AKID_Project/Intermediate_data_Dynamic/2021_Data/0320_21_data/Original_Sample_Data/onRRT/onRRT_raw/"
UK_files <- list.files(UK_onRRT_raw_dir)
UK_files_for_FinalIDs <- UK_files[which(gsub("onRRT_raw.csv","",UK_files) %in%  UK_Final_IDs== T)]
UK_rawdata <- do.call(rbind,lapply(paste0(UK_onRRT_raw_dir,UK_files_for_FinalIDs), read.csv))
#This was excluded
UK_rawdata <- UK_rawdata[,-which(colnames(UK_rawdata) %in% c("onRRT","Record_Time","FIO2","PH","PO2","onMV"))]
#####Load static data MIMIC3
UK_static_data <- read.csv(paste0(UK_data_dir,"final_demo_df.csv"),stringsAsFactors = F)
UK_static_data <- UK_static_data[,-1]
UK_static_data$ENCNTR_ID <- sapply(strsplit(UK_static_data$ENCNTR_ID,split = "_"), "[[", 1)
UK_static_data <- UK_static_data[!duplicated(UK_static_data$ENCNTR_ID),]
UK_static_data <- UK_static_data[,-which(colnames(UK_static_data) %in% c("ENCNTR_ID"))]
#Missing Rate for static
missing_count_n_UK_1 <- sapply(UK_static_data, function(x) sum(is.na(x)))
missing_perc_UK_1 <- round(missing_count_n_UK_1/nrow(UK_static_data),2)
missing_perc_UK_1
###Missing Rate for dynamic
missing_count_n_UK_2 <- sapply(UK_rawdata, function(x) sum(is.na(x)))
missing_perc_UK_2 <- round(missing_count_n_UK_2/nrow(UK_rawdata),2)
missing_perc_UK_2
length(c(missing_perc_UK_1,missing_perc_UK_2)) #21 features
mean(c(missing_perc_UK_1,missing_perc_UK_2)) #43.5%
mean(c(missing_perc_UK_2))
#MIMICs Final IDs
MIMIC3_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/MIMIC3_DL_input_data/onRRT/Hourly_interp/Filtered_FeatureFiles/"
MIMIC3_Data <- read.csv(paste0(MIMIC3_dir , "Final_Outcome_df.csv"),stringsAsFactors = F)
MIMIC3_IDs <- unique(sapply(strsplit(MIMIC3_Data$SUBJECT_ID,split = "_"), "[[", 1))
#### Load MIMIC 3 raw RRT
MIMIC3_onRRT_raw_dir <- "/Volumes/LJL_ExtPro/Data/MIMIC3/Extract_Data_AKID_Patients/Model_Data/Original_Sample_Data/onRRT/onRRT_raw/"
MIMIC3_files <- list.files(MIMIC3_onRRT_raw_dir)
MIMIC3_files_for_FinalIDs <- MIMIC3_files[which(gsub("onRRT_raw.csv","",MIMIC3_files) %in%  MIMIC3_IDs== T)]
MIMIC3_rawdata <- do.call(rbind,lapply(paste0(MIMIC3_onRRT_raw_dir,MIMIC3_files_for_FinalIDs), read.csv))
#exclude the 2 features that is not included
MIMIC3_rawdata <- MIMIC3_rawdata[,-which(colnames(MIMIC3_rawdata) %in% c("Temp","WBC","onRRT","Record_Time"))]
#####Load static data MIMIC3
MIMIC3_static_data <- read.csv(paste0(MIMIC3_dir,"final_demo_df.csv"),stringsAsFactors = F)
MIMIC3_static_data$SUBJECT_ID <- sapply(strsplit(MIMIC3_static_data$SUBJECT_ID,split = "_"), "[[", 1)
MIMIC3_static_data <- MIMIC3_static_data[!duplicated(MIMIC3_static_data$SUBJECT_ID),]
MIMIC3_static_data <- MIMIC3_static_data[,-which(colnames(MIMIC3_static_data) %in% c("SUBJECT_ID"))]
#Missing Rate for static
missing_count_n_MIMIC3_1 <- sapply(MIMIC3_static_data, function(x) sum(is.na(x)))
missing_perc_MIMIC3_1 <- round(missing_count_n_MIMIC3_1/nrow(MIMIC3_static_data),2)
missing_perc_MIMIC3_1
###Missing Rate for dynamic
missing_count_n_MIMIC3_2 <- sapply(MIMIC3_rawdata, function(x) sum(is.na(x)))
missing_perc_MIMIC3_2 <- round(missing_count_n_MIMIC3_2/nrow(MIMIC3_rawdata),2)
missing_perc_MIMIC3_2
length(c(missing_perc_MIMIC3_1,missing_perc_MIMIC3_2)) #19 features
mean(c(missing_perc_MIMIC3_1,missing_perc_MIMIC3_2)) #34.6%
mean(c(missing_perc_MIMIC3_2))
setwd("~/Desktop/DrChen_Projects/All_AKI_Projects/Other_Project/TAKI_Project/TAKI_Code")
library(lubridate)
source("TAKI_Ultility.R")
#Raw data dir
raw_dir <- "/Volumes/LJL_ExtPro/Data/AKI_Data/Taylors_Data/UKY/raw_csv_files/"
outdir <- "/Volumes/LJL_ExtPro/Data/AKI_Data/TAKI_Data_Extracted/uky/"
##########################################################################################
#1. Load data
##########################################################################################
#1.Load inclusion IDs
Inclusion_df <-read.csv(paste0(outdir,"Inclusion_IDs.csv"),stringsAsFactors = F)
#2. Corrected Time df for analysis ID
All_time_df <-read.csv(paste0(outdir,"All_Corrected_Timeinfo.csv"),stringsAsFactors = F)
#3. Kidney Transpant df
KIDT_df <- read.csv(paste0(raw_dir,"SURGERY_INDX.csv"),stringsAsFactors = F)
View(KIDT_df)
