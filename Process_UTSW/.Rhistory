}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
all_death_dates <- c(curr_dod,curr_dod2)
all_death_dates
curr_id <- 8037995
curr_id <- TimeInfo_df[i, "STUDY_PATIENT_ID"]
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
curr_dod2
curr_dod
curr_id <- 8037995
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
curr_dod2
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- ymd(curr_death_df2[,"DIED"])
}
all_death_dates <- c(curr_dod,curr_dod2)
as.character(max(all_death_dates,na.rm = T))
all_death_dates
curr_dod2
all_death_dates
all_death_dates <- c(curr_dod,curr_dod2)
all_death_dates
curr_dod2
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
c(curr_dod,curr_dod2)
all_death_dates <- c(curr_dod,ymd(curr_dod2))
all_death_dates
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- as.character(curr_death_df2[,"DIED"])
}
curr_dod2
all_death_dates <- c(curr_dod,ymd(curr_dod2))
all_death_dates
death_df[,curr_col_name]
death_df$DOD_Epic
mdy(death_df2[,curr_col_name])
reformat_cols  <- c("DIED")
mdy(death_df2[,curr_col_name])
death_df2$DIED
mdy(death_df2[,"DIED"])
##########################################################################################
# Add decease date IN TimeInfo_df
##########################################################################################
#Mortality time df
outcome_df <-read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
colnames(outcome_df)[which(colnames(outcome_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#mortality time df 2
USRDS_df <-read.csv(paste0(raw_dir,"tUSRDS_CORE_Patients.csv"),stringsAsFactors = F)
colnames(USRDS_df)[which(colnames(USRDS_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#Exclude all dod column is empty, #so this df only contains pts who died
death_df <- outcome_df[-which(outcome_df$DOD_Epic =="" &
outcome_df$DOD_NDRI == "" &
outcome_df$DMF_DEATH_DATE == ""),]
death_df2 <- USRDS_df[-which(USRDS_df$DIED == ""),]
#3.Refomart time
reformat_cols  <- c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE")
for (j in 1:length(reformat_cols)){
curr_col_name <- reformat_cols[j]
death_df[,curr_col_name] <- ymd_hms(death_df[,curr_col_name])
}
mdy(death_df2[,"DIED"])
as.character( mdy(death_df2[,"DIED"]))
death_df2[,"DIED"] <- paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00")
death_df2[,"DIED"]
death_df2[,"DIED"] <- ymd_hms(paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00"))
death_df2[,"DIED"]
paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00")
##########################################################################################
# Add decease date IN TimeInfo_df
##########################################################################################
#Mortality time df
outcome_df <-read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
colnames(outcome_df)[which(colnames(outcome_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#mortality time df 2
USRDS_df <-read.csv(paste0(raw_dir,"tUSRDS_CORE_Patients.csv"),stringsAsFactors = F)
colnames(USRDS_df)[which(colnames(USRDS_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#Exclude all dod column is empty, #so this df only contains pts who died
death_df <- outcome_df[-which(outcome_df$DOD_Epic =="" &
outcome_df$DOD_NDRI == "" &
outcome_df$DMF_DEATH_DATE == ""),]
death_df2 <- USRDS_df[-which(USRDS_df$DIED == ""),]
paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00")
ymd_hms(death_df[,curr_col_name])
paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00")
ymd_hms(paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00"))
death_df2[,"DIED"] <- ymd_hms(paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00"))
death_df2[,"DIED"]
death_df <- death_df[!duplicated(death_df[,c("STUDY_PATIENT_ID")]),]
death_df2 <- death_df2[!duplicated(death_df2[,c("STUDY_PATIENT_ID")]),]
TimeInfo_df$DECEASED_DATE <- NA
curr_id <- 8037995
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
all_death_dates <- c(curr_dod,curr_dod2)
all_death_dates
curr_dod2
as.character(max(all_death_dates,na.rm = T))
all_death_dates <- c(curr_dod,curr_dod2)
as.character(max(all_death_dates,na.rm = T))
curr_id <- 753
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
curr_dod
curr_death_df[,"DOD_Epic"]
curr_death_df
curr_death_df$DOD_Epic
death_df$DOD_Epic[1]
#Mortality time df
outcome_df <-read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
colnames(outcome_df)[which(colnames(outcome_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#mortality time df 2
USRDS_df <-read.csv(paste0(raw_dir,"tUSRDS_CORE_Patients.csv"),stringsAsFactors = F)
colnames(USRDS_df)[which(colnames(USRDS_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#Exclude all dod column is empty, #so this df only contains pts who died
death_df <- outcome_df[-which(outcome_df$DOD_Epic =="" &
outcome_df$DOD_NDRI == "" &
outcome_df$DMF_DEATH_DATE == ""),]
death_df2 <- USRDS_df[-which(USRDS_df$DIED == ""),]
death_df <- death_df[!duplicated(death_df[,c("STUDY_PATIENT_ID")]),]
death_df2 <- death_df2[!duplicated(death_df2[,c("STUDY_PATIENT_ID")]),]
curr_id <- 8037995
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
curr_dod2
all_death_dates <- c(curr_dod,ymd(curr_dod2))
all_death_dates <- c(curr_dod,mdy(curr_dod2))
all_death_dates
all_death_dates <- c(curr_dod,curr_dod2)
max(all_death_dates,na.rm = T)
#Mortality time df
outcome_df <-read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
colnames(outcome_df)[which(colnames(outcome_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#mortality time df 2
USRDS_df <-read.csv(paste0(raw_dir,"tUSRDS_CORE_Patients.csv"),stringsAsFactors = F)
colnames(USRDS_df)[which(colnames(USRDS_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#Exclude all dod column is empty, #so this df only contains pts who died
death_df <- outcome_df[-which(outcome_df$DOD_Epic =="" &
outcome_df$DOD_NDRI == "" &
outcome_df$DMF_DEATH_DATE == ""),]
death_df2 <- USRDS_df[-which(USRDS_df$DIED == ""),]
#3.Refomart time
reformat_cols  <- c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE")
for (j in 1:length(reformat_cols)){
curr_col_name <- reformat_cols[j]
death_df[,curr_col_name] <- ymd_hms(death_df[,curr_col_name])
}
death_df2[,"DIED"] <- ymd_hms(paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00"))
death_df2[,"DIED"]
death_df[,curr_col_name]
death_df$DOD_Epic
death_df <- death_df[!duplicated(death_df[,c("STUDY_PATIENT_ID")]),]
death_df2 <- death_df2[!duplicated(death_df2[,c("STUDY_PATIENT_ID")]),]
TimeInfo_df$DECEASED_DATE <- NA
curr_id <- 753
curr_id <- TimeInfo_df[i, "STUDY_PATIENT_ID"]
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
curr_dod
curr_id <- 753
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
curr_dod
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
all_death_dates <- c(curr_dod,curr_dod2)
all_death_dates
as.character(max(all_death_dates,na.rm = T))
max(all_death_dates,na.rm = T)
curr_id <- 8037995
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
curr_dod2
all_death_dates <- c(curr_dod,curr_dod2)
all_death_dates
curr_dod2
curr_dod
curr_death_df2[,"DIED"]
curr_id <- 753
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
curr_id <- 8037995
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
c(curr_dod,curr_dod2)
curr_dod
curr_id <- 753
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_id <- 8037995
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
curr_dod
curr_dod2
c(curr_dod,curr_dod2)
as.character(max(all_death_dates,na.rm = T))
all_death_dates <- c(curr_dod,curr_dod2)
as.character(max(all_death_dates,na.rm = T))
curr_id <- 8037995
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
max_dod <- max(c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
curr_dod <- max_dod
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
curr_dod
curr_dod2
c(curr_dod,curr_dod2)
death_df$DOD_COMB <- NA
i <- 1
curr_df <- death_df[i,c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE")]
curr_df
curr_df$DOD_Epic
c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"]))
c(curr_death_df[,"DOD_Epic"], curr_death_df[,"DOD_NDRI"], curr_death_df[,"DMF_DEATH_DATE"])
i <- 1
c(curr_df[,"DOD_Epic"], curr_df[,"DOD_NDRI"], curr_df[,"DMF_DEATH_DATE"])
max(c(curr_df[,"DOD_Epic"], curr_df[,"DOD_NDRI"], curr_df[,"DMF_DEATH_DATE"]),na.rm = T)
curr_max <- max(c(curr_df[,"DOD_Epic"], curr_df[,"DOD_NDRI"], curr_df[,"DMF_DEATH_DATE"]),na.rm = T)
death_df$DOD_COMB <- NA
for (i in 1:nrow(death_df)){
curr_df <- death_df[i,c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE")]
curr_max <- max(c(curr_df[,"DOD_Epic"], curr_df[,"DOD_NDRI"], curr_df[,"DMF_DEATH_DATE"]),na.rm = T)
death_df[i,"DOD_COMB"] <- curr_max
}
check_df <- death_df[,c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE","DOD_COMB")]
View(check_df)
death_df$DOD_COMB <- NA
for (i in 1:nrow(death_df)){
curr_df <- death_df[i,c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE")]
curr_max <- max(c(curr_df[,"DOD_Epic"], curr_df[,"DOD_NDRI"], curr_df[,"DMF_DEATH_DATE"]),na.rm = T)
death_df[i,"DOD_COMB"] <- as.character(curr_max)
}
check_df <- death_df[,c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE","DOD_COMB")]
#Mortality time df 1
outcome_df <-read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
colnames(outcome_df)[which(colnames(outcome_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
#Exclude all dod column is empty, #so this df only contains pts who died
death_df <- outcome_df[-which(outcome_df$DOD_Epic =="" &
outcome_df$DOD_NDRI == "" &
outcome_df$DMF_DEATH_DATE == ""),]
#3.Refomart time
reformat_cols  <- c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE")
for (j in 1:length(reformat_cols)){
curr_col_name <- reformat_cols[j]
death_df[,curr_col_name] <- ymd_hms(death_df[,curr_col_name])
}
#4.Get comb death column
death_df$DOD_COMB <- NA
for (i in 1:nrow(death_df)){
curr_df <- death_df[i,c("DOD_Epic","DOD_NDRI","DMF_DEATH_DATE")]
curr_max <- max(c(curr_df[,"DOD_Epic"], curr_df[,"DOD_NDRI"], curr_df[,"DMF_DEATH_DATE"]),na.rm = T)
death_df[i,"DOD_COMB"] <- as.character(curr_max)
}
#mortality time df 2
USRDS_df <-read.csv(paste0(raw_dir,"tUSRDS_CORE_Patients.csv"),stringsAsFactors = F)
colnames(USRDS_df)[which(colnames(USRDS_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
death_df2 <- USRDS_df[-which(USRDS_df$DIED == ""),]
death_df2[,"DIED"] <- ymd_hms(paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00"))
death_df2[,"DIED"]
death_df2[,"DIED"] <- paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00")
USRDS_df <-read.csv(paste0(raw_dir,"tUSRDS_CORE_Patients.csv"),stringsAsFactors = F)
colnames(USRDS_df)[which(colnames(USRDS_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
death_df2 <- USRDS_df[-which(USRDS_df$DIED == ""),]
death_df2[,"DIED"] <- paste(as.character(mdy(death_df2[,"DIED"])),"00:00:00")
death_df$DOD_COMB
death_df2[,"DIED"]
#mortality time df 2
USRDS_df <-read.csv(paste0(raw_dir,"tUSRDS_CORE_Patients.csv"),stringsAsFactors = F)
colnames(USRDS_df)[which(colnames(USRDS_df) == "PATIENT_NUM")] <- "STUDY_PATIENT_ID"
death_df2 <- USRDS_df[-which(USRDS_df$DIED == ""),]
death_df2[,"DIED"] <- as.character(mdy(death_df2[,"DIED"]))
death_df2[,"DIED"]
death_df$DOD_COMB
curr_id <- 753
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
max_dod <-
curr_dod <- curr_death_df$DOD_COMB
curr_dod
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
curr_dod <- curr_death_df[,"DOD_COMB"]
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
if ( all(is.na(all_death_dates)==T) == F){
TimeInfo_df[i,"DECEASED_DATE"] <-  as.character(max(all_death_dates,na.rm = T))
}else{
TimeInfo_df[i,"DECEASED_DATE"] <- NA
}
all_death_dates
curr_id <- 753
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
curr_dod <- curr_death_df[,"DOD_COMB"]
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
all_death_dates <- c(curr_dod,curr_dod2)
all_death_dates
ymd(c(curr_dod,curr_dod2))
all_death_dates <- ymd(c(curr_dod,curr_dod2))
if ( all(is.na(all_death_dates)==T) == F){
TimeInfo_df[i,"DECEASED_DATE"] <-  as.character(max(all_death_dates,na.rm = T))
}else{
TimeInfo_df[i,"DECEASED_DATE"] <- NA
}
TimeInfo_df[i,"DECEASED_DATE"]
TimeInfo_df$DECEASED_DATE <- NA
for (i in 1: nrow(TimeInfo_df)){
curr_id <- TimeInfo_df[i, "STUDY_PATIENT_ID"]
curr_death_df <- death_df[which(death_df[,"STUDY_PATIENT_ID"] ==curr_id),]
curr_death_df2 <- death_df2[which(death_df2[,"STUDY_PATIENT_ID"] ==curr_id),]
if (nrow(curr_death_df) == 0){
curr_dod <- NA
}else{
curr_dod <- curr_death_df[,"DOD_COMB"]
}
if (nrow(curr_death_df2) == 0){
curr_dod2 <- NA
}else{
curr_dod2 <- curr_death_df2[,"DIED"]
}
all_death_dates <- ymd(c(curr_dod,curr_dod2))
if ( all(is.na(all_death_dates)==T) == F){
TimeInfo_df[i,"DECEASED_DATE"] <-  as.character(max(all_death_dates,na.rm = T))
}else{
TimeInfo_df[i,"DECEASED_DATE"] <- NA
}
}
intersect(death_df$STUDY_PATIENT_ID,death_df2$STUDY_PATIENT_ID)
intersect(death_df$STUDY_PATIENT_ID,death_df2$STUDY_PATIENT_ID)
#exclude patients died before HOSP admit
exclude_idxes <- which(ymd_hms(TimeInfo_df$DECEASED_DATE) < ymd_hms(TimeInfo_df$Updated_HOSP_ADMIT_DATE))
exclude_idxes
#Reforamt add 00:00:00
curr_idxes_tochange <- which(nchar(TimeInfo_df[,"DECEASED_DATE"]) == 10)
TimeInfo_df[curr_idxes_tochange,"DECEASED_DATE"] <-  paste(TimeInfo_df[curr_idxes_tochange,"DECEASED_DATE"],"00:00:00")
#exclude patients died before HOSP admit
exclude_idxes <- which(ymd_hms(TimeInfo_df$DECEASED_DATE) < ymd_hms(TimeInfo_df$Updated_HOSP_ADMIT_DATE))
length(exclude_idxes)
check_df <- TimeInfo_df[exclude_idxes,]
#exclude patients died before HOSP admit
exclude_idxes <- which(ymd_hms(TimeInfo_df$DECEASED_DATE) < ymd_hms(TimeInfo_df$Updated_HOSP_ADMIT_DATE))
exclude_idxes
TimeInfo_df[exclude_idxes,]
source('~/Desktop/DrChen_Projects/All_AKI_Projects/Other_Project/TAKI_Project/TAKI_Code/Process_UTSW/1A_Get_CorrectedTimeInfo.R', echo=TRUE)
library(lubridate)
source("/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/Other_Project/TAKI_Project/TAKI_Code/TAKI_Ultility.R")
#Raw data dir
raw_dir <- "/Volumes/LJL_ExtPro/Data/AKI_Data/Taylors_Data/UTSW/raw_csv_files/"
outdir <- "/Volumes/LJL_ExtPro/Data/AKI_Data/TAKI_Data_Extracted/utsw/"
##########################################################################################
#Load Raw Data
##########################################################################################
#1.Load raw demo data
raw_demo_df <- read.csv(paste0(raw_dir,"tPatients"),stringsAsFactors = F)
raw_demo_df <- raw_demo_df[!duplicated(raw_demo_df[,c("STUDY_PATIENT_ID","GENDER","RACE")]),] ##remove duplicate rows
##########################################################################################
#Load Raw Data
##########################################################################################
#1.Load raw demo data
raw_demo_df <- read.csv(paste0(raw_dir,"tPatients"),stringsAsFactors = F)
##########################################################################################
#Load Raw Data
##########################################################################################
#1.Load raw demo data
raw_demo_df <- read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
colnames(raw_ADMISSION_INDX_df)
##########################################################################################
#Load Raw Data
##########################################################################################
#1.Load raw demo data
raw_demo_df <- read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
colnames(raw_ADMISSION_INDX_df)
library(lubridate)
source("/Users/lucasliu/Desktop/DrChen_Projects/All_AKI_Projects/Other_Project/TAKI_Project/TAKI_Code/TAKI_Ultility.R")
#Raw data dir
raw_dir <- "/Volumes/LJL_ExtPro/Data/AKI_Data/Taylors_Data/UTSW/raw_csv_files/"
outdir <- "/Volumes/LJL_ExtPro/Data/AKI_Data/TAKI_Data_Extracted/utsw/"
##########################################################################################
#Load Raw Data
##########################################################################################
#1.Load raw demo data
raw_demo_df <- read.csv(paste0(raw_dir,"tPatients.csv"),stringsAsFactors = F)
